# –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ WireGuard Bot

## –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã

Telegram –±–æ—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç 4 —Ä–µ–∂–∏–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–æ–ª—É—á–µ–Ω–∏—é VPN –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π.

### 1. Open (–û—Ç–∫—Ä—ã—Ç—ã–π) üåê

**–û–ø–∏—Å–∞–Ω–∏–µ:** –õ—é–±–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π.

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```env
AUTH_MODE=open
```

**–ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è:**
- –ü—É–±–ª–∏—á–Ω—ã—Ö VPN —Å–µ—Ä–≤–∏—Å–æ–≤
- –¢–µ—Å—Ç–æ–≤—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏–π
- –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —Å–µ—Ç–µ–π —Å –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–∞
- –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –≤—ã–¥–∞—á–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ—Å—Ç–æ—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

---

### 2. Whitelist (–ë–µ–ª—ã–π —Å–ø–∏—Å–æ–∫) üìã

**–û–ø–∏—Å–∞–Ω–∏–µ:** –î–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –¥–ª—è –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –æ–¥–æ–±—Ä–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞:**
```env
AUTH_MODE=whitelist
ALLOWED_USER_IDS=123456789,987654321,555666777
```

**–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å Telegram ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
1. –ß–µ—Ä–µ–∑ @userinfobot - –æ—Ç–ø—Ä–∞–≤—å—Ç–µ `/start`
2. –ß–µ—Ä–µ–∑ @raw_data_bot - –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –ª—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
3. –ß–µ—Ä–µ–∑ –±–æ—Ç–∞ - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `/start`, –≤—ã —Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `/getconfig`
2. –ï—Å–ª–∏ ID –≤ —Å–ø–∏—Å–∫–µ ‚Üí –ø–æ–ª—É—á–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
3. –ï—Å–ª–∏ ID –Ω–µ –≤ —Å–ø–∏—Å–∫–µ ‚Üí —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–∏ –¥–æ—Å—Ç—É–ø–∞

**–ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è:**
- –ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã—Ö VPN
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–≥–æ –∫—Ä—É–≥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ö–æ–≥–¥–∞ —Å–ø–∏—Å–æ–∫ –∏–∑–≤–µ—Å—Ç–µ–Ω –∑–∞—Ä–∞–Ω–µ–µ

**–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```bash
# –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
nano .env
# –î–æ–±–∞–≤—å—Ç–µ ID –≤ ALLOWED_USER_IDS
docker-compose restart tgbot
```

---

### 3. Admin Approval (–û–¥–æ–±—Ä–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∞) ‚úã

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∑–∞–ø—Ä–∞—à–∏–≤–∞—é—Ç –¥–æ—Å—Ç—É–ø, –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –æ–¥–æ–±—Ä—è—é—Ç/–æ—Ç–∫–ª–æ–Ω—è—é—Ç.

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞:**
```env
AUTH_MODE=admin_approval
```

**–ü—Ä–æ—Ü–µ—Å—Å –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `/start`
2. –í–∏–¥–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∑–∞–ø—Ä–æ—Å–∞ –¥–æ—Å—Ç—É–ø–∞
3. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `/request_access`
4. –ü–æ–ª—É—á–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–ø—Ä–æ—Å–∞
5. –û–∂–∏–¥–∞–µ—Ç –æ–¥–æ–±—Ä–µ–Ω–∏—è
6. –ü–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –æ–¥–æ–±—Ä–µ–Ω–∏–∏/–æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–∏
7. –ü–æ—Å–ª–µ –æ–¥–æ–±—Ä–µ–Ω–∏—è –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `/getconfig`

**–ü—Ä–æ—Ü–µ—Å—Å –¥–ª—è –∞–¥–º–∏–Ω–∞:**
1. –ü–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –Ω–æ–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ:
   ```
   üîî –ù–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –Ω–∞ –¥–æ—Å—Ç—É–ø
   
   üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: John Doe @johndoe
   üÜî ID: 123456789
   üìÖ –î–∞—Ç–∞: 21.01.2024, 15:30
   
   –î–µ–π—Å—Ç–≤–∏—è:
   /approve_123456789 - –æ–¥–æ–±—Ä–∏—Ç—å
   /reject_123456789 - –æ—Ç–∫–ª–æ–Ω–∏—Ç—å
   ```

2. –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤: `/pending`
3. –û–¥–æ–±—Ä–µ–Ω–∏–µ: `/approve_123456789`
4. –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ: `/reject_123456789`

**–ö–æ–º–∞–Ω–¥—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:**
- `/pending` - —Å–ø–∏—Å–æ–∫ –æ–∂–∏–¥–∞—é—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- `/approved` - —Å–ø–∏—Å–æ–∫ –æ–¥–æ–±—Ä–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `/authstats` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- `/approve_<user_id>` - –æ–¥–æ–±—Ä–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `/reject_<user_id>` - –æ—Ç–∫–ª–æ–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å
- `/revoke_<user_id>` - –æ—Ç–æ–∑–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø

**–ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è:**
- –£–º–µ—Ä–µ–Ω–Ω–æ –æ—Ç–∫—Ä—ã—Ç—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—è
- –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º—ã–π —Ä–æ—Å—Ç –±–∞–∑—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:**
–í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ SQLite: `/app/data/auth.sqlite`

–¢–∞–±–ª–∏—Ü—ã:
- `access_requests` - –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã (pending/approved/rejected)
- `approved_users` - –æ–¥–æ–±—Ä–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏

---

### 4. Closed (–ó–∞–∫—Ä—ã—Ç—ã–π) üîí

**–û–ø–∏—Å–∞–Ω–∏–µ:** –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç –ø–æ–ª—É—á–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞:**
```env
AUTH_MODE=closed
TELEGRAM_ADMIN_IDS=123456789,987654321
```

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –û–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `/getconfig`
2. –ü–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ: "–≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º"
3. –ê–¥–º–∏–Ω—ã –º–æ–≥—É—Ç —Å–≤–æ–±–æ–¥–Ω–æ –ø–æ–ª—É—á–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

**–ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è:**
- –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã—Ö VPN
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã
- –í—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è –¥–æ—Å—Ç—É–ø–∞

---

## –ü—Ä–∏–º–µ—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### –ü—Ä–∏–º–µ—Ä 1: –ù–µ–±–æ–ª—å—à–∞—è –∫–æ–º–ø–∞–Ω–∏—è (10 —á–µ–ª–æ–≤–µ–∫)

```env
AUTH_MODE=whitelist
TELEGRAM_ADMIN_IDS=111222333
ALLOWED_USER_IDS=111222333,444555666,777888999,101010101,121212121
```

**–ü–ª—é—Å—ã:** –ü—Ä–æ—Å—Ç–æ—Ç–∞, –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å
**–ú–∏–Ω—É—Å—ã:** –ù—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é –¥–æ–±–∞–≤–ª—è—Ç—å –∫–∞–∂–¥–æ–≥–æ

---

### –ü—Ä–∏–º–µ—Ä 2: –†–∞—Å—Ç—É—â–∏–π —Å—Ç–∞—Ä—Ç–∞–ø (50+ —á–µ–ª–æ–≤–µ–∫)

```env
AUTH_MODE=admin_approval
TELEGRAM_ADMIN_IDS=111222333,444555666
```

**–ü–ª—é—Å—ã:** 
- –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å
- –ê–¥–º–∏–Ω—ã –æ–¥–æ–±—Ä—è—é—Ç –≤ –±–æ—Ç–µ
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

**–ú–∏–Ω—É—Å—ã:** –¢—Ä–µ–±—É–µ—Ç —Ä–∞–±–æ—Ç—ã –∞–¥–º–∏–Ω–æ–≤

---

### –ü—Ä–∏–º–µ—Ä 3: –ü—É–±–ª–∏—á–Ω—ã–π —Å–µ—Ä–≤–∏—Å

```env
AUTH_MODE=open
TELEGRAM_ADMIN_IDS=111222333
```

**–ü–ª—é—Å—ã:** –ù—É–ª–µ–≤—ã–µ –±–∞—Ä—å–µ—Ä—ã –¥–ª—è –≤—Ö–æ–¥–∞
**–ú–∏–Ω—É—Å—ã:** –ù–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª—è –Ω–∞–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

---

### –ü—Ä–∏–º–µ—Ä 4: VPN —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤

```env
AUTH_MODE=closed
TELEGRAM_ADMIN_IDS=111222333,444555666
```

**–ü–ª—é—Å—ã:** –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
**–ú–∏–Ω—É—Å—ã:** –ù–µ—Ç –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

---

## –ö–æ–º–∞–Ω–¥—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### –î–ª—è —Ä–µ–∂–∏–º–∞ admin_approval:

```
/start - –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã
/request_access - –ó–∞–ø—Ä–æ—Å–∏—Ç—å –¥–æ—Å—Ç—É–ø
/getconfig - –ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é (–ø–æ—Å–ª–µ –æ–¥–æ–±—Ä–µ–Ω–∏—è)
/help - –ü–æ–º–æ—â—å
```

### –î–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Ä–µ–∂–∏–º–æ–≤:

```
/start - –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã
/getconfig - –ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
/help - –ü–æ–º–æ—â—å
```

---

## –ö–æ–º–∞–Ω–¥—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–æ–º:

```bash
/authstats              # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
/pending                # –°–ø–∏—Å–æ–∫ –æ–∂–∏–¥–∞—é—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
/approved               # –°–ø–∏—Å–æ–∫ –æ–¥–æ–±—Ä–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
/approve_<user_id>      # –û–¥–æ–±—Ä–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
/reject_<user_id>       # –û—Ç–∫–ª–æ–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å
/revoke_<user_id>       # –û—Ç–æ–∑–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∏—Ä–∞–º–∏:

```bash
/stats                  # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã
/list                   # –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–∏—Ä–æ–≤
/delete <peer_id>       # –£–¥–∞–ª–∏—Ç—å –ø–∏—Ä
/restrict <peer_id> <true|false>  # –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å/—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å
/admin                  # –°–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥ –∞–¥–º–∏–Ω–∞
```

---

## –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ú–∏–≥—Ä–∞—Ü–∏—è —Å open –Ω–∞ admin_approval

```bash
# 1. –ò–∑–º–µ–Ω–∏—Ç–µ .env
AUTH_MODE=admin_approval

# 2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞
docker-compose restart tgbot

# 3. –û–¥–æ–±—Ä–∏—Ç–µ —Ç–µ–∫—É—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /approved –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
# –ù–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –¥–æ–ª–∂–Ω—ã –±—É–¥—É—Ç –∑–∞–ø—Ä–æ—Å–∏—Ç—å –¥–æ—Å—Ç—É–ø
```

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ú–∞—Å—Å–æ–≤–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ whitelist

```bash
# 1. –ü–æ–ª—É—á–∏—Ç–µ —Å–ø–∏—Å–æ–∫ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
# –ü–æ–ø—Ä–æ—Å–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ—Ç–ø—Ä–∞–≤–∏—Ç—å /start
# –°–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏: docker-compose logs tgbot | grep "user_id"

# 2. –î–æ–±–∞–≤—å—Ç–µ –≤ .env
ALLOWED_USER_IDS=123,456,789,101,112,131,415,161

# 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ
docker-compose restart tgbot
```

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –í—Ä–µ–º–µ–Ω–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –¥–æ—Å—Ç—É–ø–∞

```bash
# –≠–∫—Å—Ç—Ä–µ–Ω–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ
AUTH_MODE=closed
docker-compose restart tgbot

# –í—Å–µ –Ω–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã –±—É–¥—É—Ç –æ—Ç–∫–ª–æ–Ω–µ–Ω—ã
# –ê–¥–º–∏–Ω—ã –ø—Ä–æ–¥–æ–ª–∂–∞—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
```

---

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

```bash
# –í –±–æ—Ç–µ (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤)
/authstats

# –†–µ–∑—É–ª—å—Ç–∞—Ç:
üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

–†–µ–∂–∏–º: ‚úã –û–¥–æ–±—Ä–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∞

–ó–∞–ø—Ä–æ—Å—ã:
‚Ä¢ –í—Å–µ–≥–æ: 47
‚Ä¢ –ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏: 3

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:
‚Ä¢ –û–¥–æ–±—Ä–µ–Ω–Ω—ã–µ: 42
‚Ä¢ –í –±–µ–ª–æ–º —Å–ø–∏—Å–∫–µ: 0
```

### –õ–æ–≥–∏

```bash
# –õ–æ–≥–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
docker-compose logs tgbot | grep -i "auth\|access"

# –ü—Ä–∏–º–µ—Ä—ã:
# "Access requested" - –Ω–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
# "User approved" - –æ–¥–æ–±—Ä–µ–Ω
# "User rejected" - –æ—Ç–∫–ª–æ–Ω–µ–Ω
# "Config request denied - no access" - –æ—Ç–∫–∞–∑–∞–Ω–æ –≤ –¥–æ—Å—Ç—É–ø–µ
```

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

```bash
# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
docker-compose exec tgbot sqlite3 /app/data/auth.sqlite

# –ü–æ–ª–µ–∑–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã:
SELECT * FROM access_requests WHERE status='pending';
SELECT COUNT(*) FROM approved_users;
SELECT * FROM approved_users ORDER BY approved_at DESC LIMIT 10;
```

---

## –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

### Backup –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ backup
docker-compose exec tgbot sqlite3 /app/data/auth.sqlite ".backup '/app/data/auth_backup.sqlite'"

# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Ö–æ—Å—Ç
docker cp wg-tgbot:/app/data/auth_backup.sqlite ./backups/auth_$(date +%Y%m%d).sqlite

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
docker cp ./backups/auth_20240121.sqlite wg-tgbot:/app/data/auth.sqlite
docker-compose restart tgbot
```

---

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### Best Practices

1. **–†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –æ–¥–æ–±—Ä–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**
   ```bash
   /approved  # –ï–∂–µ–º–µ—Å—è—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
   ```

2. **–£–¥–∞–ª—è–π—Ç–µ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**
   ```bash
   /list  # –°–º–æ—Ç—Ä–∏–º last handshake
   /delete <peer_id>  # –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã—Ö
   /revoke_<user_id>  # –û—Ç–∑—ã–≤–∞–µ–º –¥–æ—Å—Ç—É–ø
   ```

3. **–õ–æ–≥–∏—Ä—É–π—Ç–µ –≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—è**
   ```bash
   # –í–∫–ª—é—á–∏—Ç–µ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
   LOG_LEVEL=info  # –≤ .env
   ```

4. **–ó–∞—â–∏—Ç–∏—Ç–µ –∞–¥–º–∏–Ω—Å–∫–∏–µ ID**
   - –ù–µ –ø—É–±–ª–∏–∫—É–π—Ç–µ .env —Ñ–∞–π–ª
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–∞–∑–Ω—ã–µ ID –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∞–¥–º–∏–Ω–æ–≤
   - –†–µ–≥—É–ª—è—Ä–Ω–æ —Ä–æ—Ç–∏—Ä—É–π—Ç–µ –∞–¥–º–∏–Ω–æ–≤

5. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏**
   ```bash
   # –ß–∞—Å—Ç—ã–µ –∑–∞–ø—Ä–æ—Å—ã –æ—Ç –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   docker-compose logs tgbot | grep "user_id:123456" | wc -l
   ```

---

## Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: –ê–¥–º–∏–Ω –Ω–µ –º–æ–∂–µ—Ç –æ–¥–æ–±—Ä—è—Ç—å

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ ID –≤ —Å–ø–∏—Å–∫–µ –∞–¥–º–∏–Ω–æ–≤
grep TELEGRAM_ADMIN_IDS .env

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞
docker-compose restart tgbot
```

---

### –ü—Ä–æ–±–ª–µ–º–∞: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∞

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏
docker-compose exec tgbot sqlite3 /app/data/auth.sqlite "PRAGMA integrity_check;"

# –ï—Å–ª–∏ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∞ - –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ backup
docker cp ./backups/auth_last_good.sqlite wg-tgbot:/app/data/auth.sqlite
docker-compose restart tgbot
```

---

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

**–ü—Ä–∏—á–∏–Ω—ã:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –±–æ—Ç–∞
2. –ë–æ—Ç –Ω–µ –º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
# –õ–æ–≥–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏
docker-compose logs tgbot | grep "Failed to notify"
```

---

## FAQ

**Q: –ú–æ–∂–Ω–æ –ª–∏ –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∂–∏–º—ã?**
A: –ù–µ—Ç, —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–µ–∂–∏–º –∞–∫—Ç–∏–≤–µ–Ω. –ù–æ –≤ —Ä–µ–∂–∏–º–µ `whitelist` –∏ `admin_approval` –∞–¥–º–∏–Ω—ã –≤—Å–µ–≥–¥–∞ –∏–º–µ—é—Ç –¥–æ—Å—Ç—É–ø.

**Q: –ö–∞–∫ —É–∑–Ω–∞—Ç—å —Å–≤–æ–π Telegram ID?**
A: –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/start` –±–æ—Ç—É @userinfobot

**Q: –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ —Å–º–µ–Ω–µ —Ä–µ–∂–∏–º–∞?**
A: –û–¥–æ–±—Ä–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤ –ë–î –æ—Å—Ç–∞—é—Ç—Å—è, –Ω–æ –ø—Ä–∞–≤–∏–ª–∞ –¥–æ—Å—Ç—É–ø–∞ –º–µ–Ω—è—é—Ç—Å—è —Å–æ–≥–ª–∞—Å–Ω–æ –Ω–æ–≤–æ–º—É —Ä–µ–∂–∏–º—É.

**Q: –ú–æ–∂–Ω–æ –ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–¥–æ–±—Ä—è—Ç—å –ø–æ –¥–æ–º–µ–Ω—É email?**
A: –ù–µ—Ç, Telegram API –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç email. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–Ω–µ—à–Ω—é—é —Å–∏—Å—Ç–µ–º—É –∏–ª–∏ —Ä—É—á–Ω–æ–µ –æ–¥–æ–±—Ä–µ–Ω–∏–µ.

**Q: –ö–∞–∫ –º–∞—Å—Å–æ–≤–æ –æ–¥–æ–±—Ä–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π?**
A: –ù–∞–ø–∏—à–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–∑—ã–≤–∞–µ—Ç API –∏–ª–∏ –Ω–∞–ø—Ä—è–º—É—é –≤—Å—Ç–∞–≤–ª—è–µ—Ç –≤ –ë–î:
```bash
sqlite3 /app/data/auth.sqlite "INSERT INTO approved_users VALUES (123456789, 'username', 111222333, $(date +%s), NULL);"
```

---

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `docker-compose logs tgbot`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é: `cat .env | grep AUTH`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å: `/authstats` –≤ –±–æ—Ç–µ
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ë–î: `docker-compose exec tgbot ls -la /app/data/`
